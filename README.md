# Akarin

Akarin is a object-oriented design microkernel written in Rust, the successor of `Hikari` kernel. Currently I only track the implement progress here, before it is ready to run.

## TODO

- [x] Toolchain
  - [x] A modified version of `zig` as Mach-O linker for non-Apple and freestanding targets.
- [ ] Akarin Bootloader
  - [x] PIE Mach-O Loader (For `ld64.lld` compatibility)
  - [x] Configuration Parser
  - [x] Interactive mode
  - [ ] Custom Page Mapper based on our own abstractions
  - [x] Can boot a simple kernel
  - [ ] Map kernel stack instead of directly using HHDM map
- [ ] Akarin Kernel
  - [ ] libakarin
    - [ ] Core (Abstraction)
      - [ ] Scheduler Abstraction
      - [x] Clock/Timer Abstraction
      - [ ] Interrupt Abstraction (Well, in a mess currently)
        - [x] Interrupt Controller
        - [x] Trap Handler
        - [ ] Refactor Abstractions
          - [ ] MSI/MSI-X interrupt abstraction
          - [x] IRQ Register
          - [x] IRQ Migrate
          - [ ] IRQ Allocation Abstraction (Maybe abstract IRQ resource as an independent object? Just let driver to aquire them from object pool? Or abstract them as a kind of capability and bound to device objects? Let's finish my object pool first, then I'll figure out this.)
      - [ ] Io Abstraction
      - [ ] Memory Abstraction
        - [x] Page Table
        - [x] Address Space
        - [x] Frame Allocator
        - [ ] Object Allocator
      - [x] Sync Abstraction
        - [x] Scoped Guard
      - [x] Context Abstraction (May change during implementation)
        - [x] Trap Context
        - [x] User Context
      - [x] CPU Abstraction
        - [x] per-CPU controller (interrupt, per-CPU data init, cpu-id obtain)
        - [x] per-CPU variable 
      - [ ] Machine (ISA) Abstraction
        - [ ] Wireup all types
        - [ ] Initialization Abstraction (?)
    - [ ] Memory
      - [ ] Integrate LLFree Frame Allocator
      - [ ] Slub Object Allocator
      - [ ] Top level Allocator
    - [ ] Sync
      - [x] Spin
        - [x] SpinLock
        - [x] RwLock
        - [x] Barrier
        - [x] OnceLock
        - [x] Lazy
      - [x] Async
        - [x] Mutex
        - [x] Semaphore
        - [x] RwLock
        - [x] Condvar
        - [x] Barrier
      - [x] Garbage Collector
        - [x] Atomic Primitives (Adapt from `crossbeam-epoch`)
        - [x] Lock-free linked list (Adapt from `crossbeam-epoch`)
        - [x] Hyaline-1 Garbage Collector (Based on `seize`, drop `tls` backend and ported to `no_std` environment)
    - [ ] Object Subsystem
      - [x] Object Model
      - [x] Capability Model
      - [x] Registry
      - [ ] Event Dispatcher (Requires task system to be done)
  - [ ] akarin
    - [ ] Kernel Runtime
      - [ ] Thread model on the top of Rust async model
      - [ ] `EEVDF` async executor
      - [ ] Time scheduler (May migrate from `Hikari` kernel)
    - [ ] Kernel
      - [ ] Process Model managing resource
      - [ ] Syscall
      - [ ] SMP
      - [ ] Maybe more, let's finish `libakarin` first.
